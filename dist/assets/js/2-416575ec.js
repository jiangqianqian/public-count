webpackJsonp([2],{15:function(t,e,a){var i=a(1);t.exports={tpl:function(t){return'<a class="tab-item external'+(0==t.index?" active":"")+'" href="javascript:;" data-index="0" data-href=""> <span class="icon icon-pai"></span> <span class="tab-label">派单</span></a><a class="tab-item external'+(1==t.index?" active":"")+'" href="javascript:;" data-index="1" data-href="/order"> <span class="icon icon-order"></span> <span class="tab-label">订单</span></a><a class="tab-item external'+(2==t.index?" active":"")+'" href="javascript:;" data-index="2" data-href="/profile"> <span class="icon icon-user"></span> <span class="tab-label">我的</span></a>'},listen:{update:function(){this.data.index=i.navIndex||0}},events:{"click .tab-item":"switchTab"},handle:{switchTab:function(t){var e=$(t.currentTarget);i.navIndex=e.data("index"),i.cr.go(e.data("href"))}}}},18:function(t,e){var a={};!function(){function t(t,e,a){0!=e.indexOf("on")&&(e="on"+e);var n=new i.lang.Event(e);if(a)for(var o in a)n[o]=a[o];t.dispatchEvent(n)}function e(t){if(t){var a=t.attributes,i="";if(a)for(var n=0,o=a.length;n<o;n++)i=a[n].name,"function"==typeof t[i]&&(t[i]=null);var r=t.childnodes;if(r)for(var n=0,o=r.length;n<o;n++)e(t.childnodes[n])}}var i=i||{guid:"$BAIDU$"};!function(){window[i.guid]={},i.extend=function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);return t},i.lang=i.lang||{},i.lang.guid=function(){return"TANGRAM__"+(window[i.guid]._counter++).toString(36)},window[i.guid]._counter=window[i.guid]._counter||1,window[i.guid]._instances=window[i.guid]._instances||{},i.lang.Class=function(t){this.guid=t||i.lang.guid(),window[i.guid]._instances[this.guid]=this},window[i.guid]._instances=window[i.guid]._instances||{},i.lang.isString=function(t){return"[object String]"==Object.prototype.toString.call(t)},i.isString=i.lang.isString,i.lang.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},i.lang.Event=function(t,e){this.type=t,this.returnValue=!0,this.target=e||null,this.currentTarget=null},i.lang.Class.prototype.addEventListener=function(t,e,a){if(i.lang.isFunction(e)){!this.__listeners&&(this.__listeners={});var n,o=this.__listeners;if("string"==typeof a&&a){if(/[^\w\-]/.test(a))throw"nonstandard key:"+a;e.hashCode=a,n=a}0!=t.indexOf("on")&&(t="on"+t),"object"!=typeof o[t]&&(o[t]={}),n=n||i.lang.guid(),e.hashCode=n,o[t][n]=e}},i.lang.Class.prototype.removeEventListener=function(t,e){if(i.lang.isFunction(e))e=e.hashCode;else if(!i.lang.isString(e))return;!this.__listeners&&(this.__listeners={}),0!=t.indexOf("on")&&(t="on"+t);var a=this.__listeners;a[t]&&a[t][e]&&delete a[t][e]},i.lang.Class.prototype.dispatchEvent=function(t,e){i.lang.isString(t)&&(t=new i.lang.Event(t)),!this.__listeners&&(this.__listeners={}),e=e||{};for(var a in e)t[a]=e[a];var a,n=this.__listeners,o=t.type;if(t.target=t.target||this,t.currentTarget=this,0!=o.indexOf("on")&&(o="on"+o),i.lang.isFunction(this[o])&&this[o].apply(this,arguments),"object"==typeof n[o])for(a in n[o])n[o][a].apply(this,arguments);return t.returnValue},i.dom=i.dom||{},i.dom._g=function(t){return i.lang.isString(t)?document.getElementById(t):t},i._g=i.dom._g,i.event=i.event||{},i.event._listeners=i.event._listeners||[],i.event.on=function(t,e,a){e=e.replace(/^on/i,""),t=i.dom._g(t);var n,o=function(e){a.call(t,e)},r=i.event._listeners,s=i.event._eventFilter,l=e;return e=e.toLowerCase(),s&&s[e]&&(n=s[e](t,e,o),l=n.type,o=n.listener),t.addEventListener?t.addEventListener(l,o,!1):t.attachEvent&&t.attachEvent("on"+l,o),r[r.length]=[t,e,a,o,l],t},i.on=i.event.on,i.event.un=function(t,e,a){t=i.dom._g(t),e=e.replace(/^on/i,"").toLowerCase();for(var n,o,r,s=i.event._listeners,l=s.length,d=!a;l--;)n=s[l],n[1]!==e||n[0]!==t||!d&&n[2]!==a||(o=n[4],r=n[3],t.removeEventListener?t.removeEventListener(o,r,!1):t.detachEvent&&t.detachEvent("on"+o,r),s.splice(l,1));return t},i.un=i.event.un,i.preventDefault=i.event.preventDefault=function(t){t.preventDefault?t.preventDefault():t.returnValue=!1}}();var n=a.RichMarker=function(t,e,a){t&&e&&e instanceof BMap.Point&&(this._map=null,this._content=t,this._position=e,this._container=null,this._size=null,a=a||{},this._opts=i.extend(i.extend(this._opts||{},{enableDragging:!1,anchor:new BMap.Size(0,0)}),a))};n.prototype=new BMap.Overlay,n.prototype.initialize=function(t){var e=this,a=e._container=document.createElement("div");return e._map=t,i.extend(a.style,{position:"absolute",zIndex:BMap.Overlay.getZIndex(e._position.lat),background:"#FFF",cursor:"pointer"}),t.getPanes().labelPane.appendChild(a),e._appendContent(),e._setEventDispath(),e._getContainerSize(),a},n.prototype.draw=function(){var t=this._map,e=this._opts.anchor,a=t.pointToOverlayPixel(this._position);this._container.style.left=a.x+e.width+"px",this._container.style.top=a.y+e.height+"px"},n.prototype.enableDragging=function(){this._opts.enableDragging=!0},n.prototype.disableDragging=function(){this._opts.enableDragging=!1},n.prototype.isDraggable=function(){return this._opts.enableDragging},n.prototype.getPosition=function(){return this._position},n.prototype.setPosition=function(t){!t instanceof BMap.Point||(this._position=t,this.draw())},n.prototype.getAnchor=function(){return this._opts.anchor},n.prototype.setAnchor=function(t){!t instanceof BMap.Size||(this._opts.anchor=t,this.draw())},n.prototype._appendContent=function(){var t=this._content;if("string"==typeof t){var e=document.createElement("DIV");if(e.innerHTML=t,1==e.childNodes.length)t=e.removeChild(e.firstChild);else{for(var a=document.createDocumentFragment();e.firstChild;)a.appendChild(e.firstChild);t=a}}this._container.innerHTML="",this._container.appendChild(t)},n.prototype.getContent=function(){return this._content},n.prototype.setContent=function(t){t&&(this._content=t,this._appendContent())},n.prototype._getContainerSize=function(){if(this._container){var t=this._container.offsetHeight,e=this._container.offsetWidth;this._size=new BMap.Size(e,t)}},n.prototype.getWidth=function(){if(this._size)return this._size.width},n.prototype.setWidth=function(t){this._container&&(this._container.style.width=t+"px",this._getContainerSize())},n.prototype.getHeight=function(){if(this._size)return this._size.height},n.prototype.setHeight=function(t){this._container&&(this._container.style.height=t+"px",this._getContainerSize())},n.prototype._setEventDispath=function(){function e(t){var t=window.event||t,e=t.pageX||t.clientX||0,i=t.pageY||t.clientY||0,n=new BMap.Pixel(e,i);return{pixel:n,point:a._map.pixelToPoint(n)}}var a=this,n=a._container,o=!1,r=null;i.on(n,"onclick",function(e){t(a,"onclick")}),i.on(n,"ontouchend",function(e){t(a,"ontouchend"),t(a,"onclick")}),i.on(n,"ondblclick",function(i){var n=e(i);t(a,"ondblclick",{point:n.point,pixel:n.pixel})}),n.onmouseover=function(i){var n=e(i);t(a,"onmouseover",{point:n.point,pixel:n.pixel})},n.onmouseout=function(i){var n=e(i);t(a,"onmouseout",{point:n.point,pixel:n.pixel})};var s=function(d){var c=e(d);t(a,"onmouseup",{point:c.point,pixel:c.pixel}),a._container.releaseCapture?(i.un(n,"onmousemove",l),i.un(n,"onmouseup",s)):(i.un(window,"onmousemove",l),i.un(window,"onmouseup",s)),a._opts.enableDragging&&(a._container.releaseCapture&&a._container.releaseCapture(),t(a,"ondragend",{point:c.point,pixel:c.pixel}),o=!1,r=null,a._setCursor("dragend"),a._container.style.MozUserSelect="",a._container.style.KhtmlUserSelect="",a._container.style.WebkitUserSelect="",a._container.unselectable="off",a._container.onselectstart=function(){})},l=function(i){if(a._opts.enableDragging&&o){var n=e(i),s=a._map.pointToPixel(a._position),l=n.pixel.x-r.x+s.x,d=n.pixel.y-r.y+s.y;r=n.pixel,a._position=a._map.pixelToPoint(new BMap.Pixel(l,d)),a.draw(),a._setCursor("dragging"),t(a,"ondragging",{point:n.point,pixel:n.pixel})}};i.on(n,"onmousedown",function(d){var c=e(d);t(a,"onmousedown",{point:c.point,pixel:c.pixel}),a._container.setCapture?(i.on(n,"onmousemove",l),i.on(n,"onmouseup",s)):(i.on(window,"onmousemove",l),i.on(window,"onmouseup",s)),a._opts.enableDragging&&(r=c.pixel,t(a,"ondragstart",{point:c.point,pixel:c.pixel}),o=!0,a._setCursor("dragstart"),a._container.setCapture&&a._container.setCapture(),a._container.style.MozUserSelect="none",a._container.style.KhtmlUserSelect="none",a._container.style.WebkitUserSelect="none",a._container.unselectable="on",a._container.onselectstart=function(){return!1})})},n.prototype._setCursor=function(t){var e="",a={moz:{dragstart:"-moz-grab",dragging:"-moz-grabbing",dragend:"pointer"},other:{dragstart:"move",dragging:"move",dragend:"pointer"}};e=-1!==navigator.userAgent.indexOf("Gecko/")?a.moz[t]:a.other[t],this._container.style.cursor!=e&&(this._container.style.cursor=e)},n.prototype.remove=function(){t(this,"onremove"),this._container&&e(this._container),this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container)}}(),t.exports=a},23:function(t,e,a){var i=a(1),n=a(2);t.exports={tpl:function(t){var e="undefined"!=typeof _encodeHTML?_encodeHTML:function(t){var e={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},a=/&(?!#?\w+;)|<|>|"|'|\//g;return function(t){return t?t.toString().replace(a,function(t){return e[t]||t}):""}}(),a='<div class="list-block media-list"> <ul> ',i=t.items;if(i)for(var n,o=-1,r=i.length-1;o<r;)n=i[o+=1],a+=' <div class="item" data-id="'+e(n.id)+'"> <div class="item-title"><span class="garden ellipsis">'+e(n.gardenName)+'</span> <span class="build ellipsis">'+e(n.buildName)+'</span> <span class="ellipsis">'+e(n.unitName)+'</span> <span class="ellipsis">'+e(n.roomNumber)+'</span></div> <li class="item-content"> <div class="item-inner"> <div class="item-subtitle">'+e(n.appointmentName)+" "+e(n.appointmentPhone)+"<br>订单编号："+e(n.appointmentNo)+'</div> </div> <div class="item-right"> <div class="item-info" style="padding-top: '+e(t.showDate?.5:.75)+'rem;"> <span class="item-time">'+e((n.hour||"00")+":"+(n.minute||"00"))+"</span>",n.isConflictTime&&(a+='<span class="item-warn">!</span>'),a+=" ",t.showDate&&(a+='<br><span class="item-date">'+e(n.dayLabel)+" <span>("+e(n.month)+"月"+e(n.day)+"日)</span></span>"),a+=' </div> <div class="item-ops"> <a class="icon icon-call" href="javascript:;" data-href="tel:'+e(n.appointmentPhone)+'"></a> <a class="icon icon-jie" data-id='+e(n.id)+"></a> </div> </div> </li> </div> ";return a+=" </ul></div><style scoped> .list-block { margin: 0 }  .item-inner { align-self: flex-start; } .list-block .item-content { padding-left: 0.5rem; } .list-block .item-content:after { content: ''; position: absolute; left: 0.5rem; bottom: 0; right: auto; top: auto; height: 1px; width: calc(100% - 0.5rem); background-color: #e7e7e7; display: block; z-index: 15; -webkit-transform-origin: 50% 100%; transform-origin: 50% 100%; } .list-block.media-list .item-inner { padding-top: 0; padding-bottom: 0.7rem; } .list-block .item-inner:after { background-color: #ffffff; } .item-title { color: #2e2e2e; font-size: 0.75rem; line-height: 1rem; font-weight: 400; padding-left: 0.5rem; padding-top: 0.8rem; } .item-subtitle { color: #a6a6a6; font-size: 0.6rem; line-height: 0.85rem; padding-top: 0.3rem; font-weight: 400; }  .item-right { margin-right: 0.5rem; align-self: flex-start; padding-bottom: 0.45rem; width: 16rem; clear: both; } .item-info { display: inline-block; line-height: 0.6rem; padding-top: 0.5rem; vertical-align: bottom; }  .item-ops { font-size: 1.2rem; text-align: right; width: 3.5rem; display: inline-block; padding-top: 0.15rem; float: right; } .item-time { color: #ff9911; font-size: 0.8rem; line-height: 0.75rem; font-weight: 700; margin-right: 0.3rem; } .item-date { font-size: 0.55rem; color: #2e2e2e; } .item-date span { color: #a6a6a6; } .item-warn { font-size: 0.8rem; line-height: 0.8rem; font-weight: 900; color: #ff0000; margin-right: 0.75rem; }  .item-ops .icon { font-size: 0.6rem; height: 1.25rem; line-height: 1.2rem; width: 1.25rem; border-radius: 50%; text-align: center; border: 1px solid #ff9911; color: #ff9911; } .item-ops .icon-call { border: 1px solid #25ae5f; color: #25ae5f; margin-right: 0.5rem; } .item-title .ellipsis { display: inline-block; text-overflow: ellipsis; overflow: hidden; vertical-align: middle; } .item-title .garden { max-width: 4.7rem; } .item-title .build { max-width: 3.75rem; }</style>"},data:{items:[],showDate:!1},events:{"click div.item":"openDetail","click .icon-call":"call","click .icon-jie":"ordering"},handle:{openDetail:function(t){"A"!=t.target.tagName&&(this.parent.modal&&$.closeModal(this.parent.modal),i.cr.go("/detail/"+$(t.currentTarget).data("id")))},call:function(t){location.href=$(t.target).data("href")},ordering:function(t){var e=this,a=$(t.target).data("id");$.showIndicator(),$.ajax({data:{personId:i.personId,id:a},url:n.apiUrl+"isReceiveBill"}).done(function(t){$.hideIndicator(),"C0000"==t.code?(e.parent.modal&&$.closeModal(e.parent.modal),i.curOrder={status:"WAITING_ORDER",id:a},i.cr.go("/form")):$.toast(t.msg)})}}}},9:function(t,e,a){var i=a(1),n=a(18),o=a(2),r=a(23);t.exports={tpl:function(t){var e="undefined"!=typeof _encodeHTML?_encodeHTML:function(t){var e={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},a=/&(?!#?\w+;)|<|>|"|'|\//g;return function(t){return t?t.toString().replace(a,function(t){return e[t]||t}):""}}(),a='<div class="page page-current"> <header class="bar bar-nav"> <div class="buttons-tab "> <a href="#tab1" class="tab-link';return 1==t.tabIndex&&(a+=" active"),a+=' button">列表</a> <a href="#tab2" class="tab-link',2==t.tabIndex&&(a+=" active"),a+=' button">地图</a> </div> </header> <div id="contentScroll" class="content infinite-scroll infinite-scroll-bottom" data-distance="50"> <div class="tabs"> <div id="tab1" class="tab',1==t.tabIndex&&(a+=" active"),a+='"> ',t.date1&&(a+=' <div class="list-title"> 今天<span> ('+e(t.date1)+") </span> </div> "),a+=' <div id="list1" class="list-body"></div> ',t.date2&&(a+=' <div class="list-title"> 明天<span> ('+e(t.date2)+") </span> </div> "),a+=' <div id="list2" class="list-body"></div> </div> <div id="tab2" class="tab',2==t.tabIndex&&(a+=" active"),a+='"> <div id="listMap"> </div> </div> </div> <div class="infinite-scroll-preloader scroll-loading"> <div class="preloader"></div> </div> <div class="infinite-scroll-preloader nomore-data"> 没有更多数据了 </div> <div class="infinite-scroll-preloader no-data"> <img class="img" src="assets/img/nodata.png"> <div>暂无任何派单</div> </div> </div> <div class="warn" style="display: '+(t.showWarn&&!t.closeWarn?"block":"none")+';"><b>!</b>表示和您现在的已有待拍摄订单有时间冲突<span id="closeWarn">&times;</span></div> <nav id="nav" class="bar bar-tab"></nav> <div class="popup popup-layer"> <div class="layer-header">万科金域蓝湾 ( <span>3</span> )</div> <div id="layerScroll" class="layer-content content infinite-scroll infinite-scroll-bottom" data-distance="50"> <div id="mapList"></div> <div class="infinite-scroll-preloader scroll-loading"> <div class="preloader"></div> </div> <div class="infinite-scroll-preloader nomore-data"> 没有更多数据了 </div> </div> <a href="javascript:;" class="button button-fill button-cancel">取 消</a> </div></div><style scoped> .bar { padding: 0; } .bar .button { line-height: 2.2rem; height: 2.2rem; top: 0; } .content { margin-bottom: 2.5rem; } .list-title { height: 1.5rem; margin-top: 0.5rem; padding-left: 0.5rem; font-size: 0.8rem; font-weight: 400; color: #2e2e2e; box-shadow: 0 1px 0 #dddddd; background-color: #efeff4; } .list-title span { color: #b8b8b9; } #tab2 #listMap { position: absolute; top: 0; bottom: 0; left: 0; right: 0; } .bmap-label { background:#25ae5f;; color: #ffffff; padding: 0.2rem 0.5rem; position: absolute; display: inline; cursor: inherit; border: 0px none; border-radius: 5px; white-space: nowrap; font-size: 0.6rem; font-weight: 400; z-index: 80; left: 15px; top: -35px; -moz-user-select: none; } .bmap-label span { font-weight: 700; margin-right: 0.5rem; } .bmap-label:after { content:""; position:absolute; top:1.2rem; left:0.5rem; border: 0.3rem solid transparent; border-top-color: #25ae5f; } .bmap-label.active { background:#ff9911;; } .bmap-label.active:after { border-top-color: #ff9911; } .warn { position: fixed; bottom: 2.5rem; width: 100%; height: 1.25rem; background-color: #ffcc99; color: #000000; font-size: 0.6rem; line-height: 1.25rem; padding-left: 0.5rem; font-weight: 400; clear: both; z-index: 16; } .warn b { font-size: 0.65rem; font-weight: 900; margin-right: 0.2rem; color: #ff0000; } .warn span { float: right; font-size: 1rem; line-height: 1rem; padding: 0 0.5rem 0.2rem 0.5rem; color: #666666; } .popup-layer { height: 12.5rem; top: initial; bottom: 0; z-index: 9; margin-bottom: 2.5rem; overflow: hidden; } .popup-layer .layer-header { font-size: 0.75rem; line-height: 0.75rem; color: #2e2e2e; background: #efeff4; font-weight: 400; padding: 0.4rem 0.5rem; } .popup-layer .layer-header span { color: #ff9911; font-weight: 700; } .popup-layer .layer-content { height: 8.5rem; } .layer-content.content { margin-bottom: initial; position: initial; } .popup-layer .button-cancel { height: 2rem; line-height: 2rem; background-color: #ff9911; border-color: #ff9911; color: #ffffff; font-size: 0.7rem; font-weight: 400; margin: 0.5rem 0 0 0; border-radius: 0; } .nomore-data, .no-data { display: none; color: #a6a6a6; font-size: 0.75rem; } .no-data { margin-top: 4rem; } .no-data img { height: 8rem; } #mapList .item-info { padding-top: 0.3rem !important; text-align: right; } #mapList .item-time { margin-bottom: 0.1rem; margin-right: 0; display: inline-block; }</style>'},data:{showWarn:!1},refs:{nav:{el:"#nav",component:a(15)},list1:{el:"#list1",component:r,data:{items:[],showDate:!1}},list2:{el:"#list2",component:r,data:{items:[],showDate:!1}}},listen:{mount:function(){if(i.setTitle("实勘派单"),"2"==this.data.tabIndex){this.fetchMapDataList()}else this.refresh(),this.$("#contentScroll").on("infinite",this.loadmore.bind(this))},updated:function(){this.fetched&&(this.refs.list1.data.items.length||this.refs.list2.data.items.length?this.fetchParams.page<this.data.pageCount?(this.$("#contentScroll .no-data").hide(),this.$("#contentScroll .scroll-loading").show(),this.$("#contentScroll .nomore-data").hide()):(this.$("#contentScroll .scroll-loading").hide(),this.loaded&&this.$("#contentScroll .nomore-data").show()):(this.$("#contentScroll .scroll-loading").hide(),this.$("#contentScroll .no-data").show()))}},mixins:{fetchParams:{personId:i.personId,page:1,pageSize:10},fetch:function(){var t=this;return $.ajax({data:t.fetchParams,url:o.apiUrl+"getAppointmentBills"})},refresh:function(){var t=this;this.loaded=!1,this.fetchParams.page=1,this.fetch().done(function(e){if("C0000"==e.code){if(e.data.todayData&&e.data.todayData.items.length){var a=new Date(e.data.todayData.date);if(t.data.date1=a.getMonth()+1+"月"+a.getDate()+"日",t.refs.list1.data.items=e.data.todayData.items,"1"==t.data.tabIndex&&t.refs.list1.data.items.length)for(var i=0;i<t.refs.list1.data.items.length;i++)if(t.refs.list1.data.items[i].isConflictTime){t.data.showWarn=!0;break}}if(e.data.tomorrowData&&e.data.tomorrowData.items.length){var n=new Date(e.data.tomorrowData.date);if(t.data.date2=n.getMonth()+1+"月"+n.getDate()+"日",t.refs.list2.data.items=e.data.tomorrowData.items,"1"==t.data.tabIndex&&t.refs.list2.data.items.length)for(var i=0;i<t.refs.list2.data.items.length;i++)if(t.refs.list2.data.items[i].isConflictTime){t.data.showWarn=!0;break}}t.fetched=!0,t.data.pageCount=e.data.pageCount,t.update()}else $.toast(e.msg);t.$(".content.infinite-scroll").scrollTop(0)})},fetchMapDetailParams:{personId:i.personId,page:1,pageSize:5},fetchMapDataList:function(){var t=this;$.ajax({data:{personId:i.personId},url:o.apiUrl+"getReceiveMapData"}).done(function(e){"C0000"==e.code?t.renderMap(e.data.items):$.toast(e.msg)})},fetchMapDataDetail:function(){var t=this;return $.ajax({data:t.fetchMapDetailParams,url:o.apiUrl+"getAppointmentBillListForMap"})},loadmoreMapDetail:function(){var t=this,e=this.$("#layerScroll");$.detachInfiniteScroll(e),this.fetchMapDetailParams.page>=this.mapList.data.pageCount||(this.loaded=!0,this.fetchMapDetailParams.page++,this.fetchMapDataDetail().done(function(a){"C0000"==a.code&&(t.mapList.data.items=t.mapList.data.items.concat(a.data.data),t.mapList.data.pageCount=a.data.pageCount,t.mapList.update(),$.attachInfiniteScroll(e))}))},loadmore:function(){var t=this,e=this.$("#contentScroll");if($.detachInfiniteScroll(e),this.fetchParams.page>=this.data.pageCount)return this.$("#contentScroll .scroll-loading").hide(),void(this.loaded&&this.$("#contentScroll .nomore-data").show());this.loaded=!0,this.fetchParams.page++,this.fetch().done(function(a){if("C0000"==a.code){if(a.data.todayData&&a.data.todayData.items.length){var i=new Date(a.data.todayData.date);if(t.data.date1=i.getMonth()+1+"月"+i.getDate()+"日",t.refs.list1.data.items=t.refs.list1.data.items.concat(a.data.todayData.items),"1"==t.data.tabIndex&&t.refs.list1.data.items.length)for(var n=0;n<t.refs.list1.data.items.length;n++)if(t.refs.list1.data.items[n].isConflictTime){t.data.showWarn=!0;break}}if(a.data.tomorrowData&&a.data.tomorrowData.items.length){var o=new Date(a.data.tomorrowData.date);if(t.data.date2=o.getMonth()+1+"月"+o.getDate()+"日",t.refs.list2.data.items=t.refs.list2.data.items.concat(a.data.tomorrowData.items),"1"==t.data.tabIndex&&t.refs.list2.data.items.length)for(var n=0;n<t.refs.list2.data.items.length;n++)if(t.refs.list2.data.items[n].isConflictTime){t.data.showWarn=!0;break}}t.data.pageCount=a.data.pageCount,t.update(),$.attachInfiniteScroll(e)}})},renderMap:function(t){var e=this;if(this.$("#contentScroll .scroll-loading").hide(),t&&t.length){this.bMap=o.initMap({el:"listMap"});var a=[];$.each(t,function(t,i){var o='<label class="bmap-label" unselectable="on"><span>'+i.appointmentNum+"</span>"+i.gardenName+"</label>",r=new BMap.Point(i.gardenLongitude,i.gardenLatitude);a.push(r);var s=new n.RichMarker(o,r);s.addEventListener("onclick",e.handleMarker.bind(e,i)),e.bMap.addOverlay(s)}),this.bMap.setViewport(a)}else this.$("#listMap").append($(".no-data")),this.$("#listMap .no-data").show()},handleMarker:function(t,e){var a=this;this.$(".bmap-label.active").removeClass("active"),$(e.target.U).find(".bmap-label").addClass("active"),a.$(".layer-content.infinite-scroll").scrollTop(0),$.showIndicator(),a.fetchMapDetailParams.page=1,a.fetchMapDetailParams.gardenId=t.gardenId,this.fetchMapDataDetail().done(function(e){"C0000"==e.code&&(a.$(".popup-layer .layer-header").html(t.gardenName+" ( <span>"+t.appointmentNum+"</span> )"),$.popup(".popup-layer"),a.mapList&&a.mapList.unmount(),a.mapList=i.component(r),a.mapList.data={items:e.data.data},a.mapList.data.pageCount=e.data.pageCount,a.mapList.data.showDate=!0,a.mapList.on("mount",function(){a.$("#layerScroll").on("infinite",a.loadmoreMapDetail.bind(a)),$.initInfiniteScroll("#layerScroll"),$.hideIndicator(),a.loaded=!1,a.$("#layerScroll .nomore-data").hide()}),a.mapList.on("updated",function(){this.data.items.length?a.fetchMapDetailParams.page<this.data.pageCount?(a.$("#layerScroll .scroll-loading").show(),a.$("#layerScroll .nomore-data").hide()):(a.$("#layerScroll .scroll-loading").hide(),a.loaded&&a.$("#layerScroll .nomore-data").show()):a.$("#layerScroll .scroll-loading").hide()}),a.mapList.mount(a.es+" #mapList"),a.mapList.parent=a)})}},events:{"click .tab-link":"hashTab","click #closeWarn":"closeWarn","click .button-cancel":"closeMapList"},handle:{hashTab:function(t){var e=$(t.target).attr("href").replace("#","");i.cr.go("/list/"+e)},closeWarn:function(t){this.$(".warn").hide(),this.data.closeWarn=!0},closeMapList:function(){this.$(".layer-content.infinite-scroll").scrollTop(0),this.$(".bmap-label.active").removeClass("active"),$.closeModal(".popup")}}}}});